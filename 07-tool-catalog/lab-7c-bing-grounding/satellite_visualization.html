<!DOCTYPE html>
<html>
<head>
    <title>Satellites</title>
    <style>
        *{margin:0;padding:0}
        body{background:#0a0a0f;overflow:hidden}
        canvas{display:block}
        .info{position:fixed;bottom:20px;left:20px;color:#444;font:12px monospace}
        .info span{color:#888}
    </style>
</head>
<body>
<div class="info"><span id="n">11700</span> satellites in orbit</div>
<canvas id="c"></canvas>
<script>
const TOTAL = 11700; // Updated from research
const DISPLAY = 800;

const c = document.getElementById('c');
const gl = c.getContext('webgl');
c.width = innerWidth; c.height = innerHeight;
gl.viewport(0,0,c.width,c.height);

const vs = `
attribute vec3 p;
uniform mat4 m;
void main(){
    gl_Position = m * vec4(p,1.0);
    gl_PointSize = 1.5;
}`;
const fs = `
precision lowp float;
void main(){
    float d = length(gl_PointCoord - 0.5);
    if(d > 0.5) discard;
    gl_FragColor = vec4(0.7, 0.75, 0.8, 1.0 - d*1.5);
}`;

function sh(t,s){const x=gl.createShader(t);gl.shaderSource(x,s);gl.compileShader(x);return x;}
const pg = gl.createProgram();
gl.attachShader(pg, sh(gl.VERTEX_SHADER, vs));
gl.attachShader(pg, sh(gl.FRAGMENT_SHADER, fs));
gl.linkProgram(pg); gl.useProgram(pg);

const pLoc = gl.getAttribLocation(pg,'p');
const mLoc = gl.getUniformLocation(pg,'m');

// Earth
const earth = [];
for(let i=0;i<3000;i++){
    const u = Math.random()*Math.PI*2, v = Math.acos(2*Math.random()-1);
    earth.push(Math.sin(v)*Math.cos(u), Math.cos(v), Math.sin(v)*Math.sin(u));
}
const eBuf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, eBuf);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(earth), gl.STATIC_DRAW);

// Satellites
const sats = [];
for(let i=0;i<DISPLAY;i++){
    const r = 1.1 + Math.random()*0.8;
    const inc = (Math.random()*0.7+0.1)*Math.PI;
    const raan = Math.random()*Math.PI*2;
    const ph = Math.random()*Math.PI*2;
    const sp = 0.002 + Math.random()*0.008;
    sats.push({r,inc,raan,ph,sp});
}
const satPos = new Float32Array(DISPLAY*3);
const sBuf = gl.createBuffer();

function perspective(f,a,n,far){
    const t=1/Math.tan(f/2);
    return new Float32Array([t/a,0,0,0,0,t,0,0,0,0,(far+n)/(n-far),-1,0,0,2*far*n/(n-far),0]);
}
function lookAt(e,c,u){
    const z=norm([e[0]-c[0],e[1]-c[1],e[2]-c[2]]);
    const x=norm(cross(u,z));
    const y=cross(z,x);
    return new Float32Array([x[0],y[0],z[0],0,x[1],y[1],z[1],0,x[2],y[2],z[2],0,-dot(x,e),-dot(y,e),-dot(z,e),1]);
}
function mult(a,b){
    const r=new Float32Array(16);
    for(let i=0;i<4;i++)for(let j=0;j<4;j++){r[i*4+j]=0;for(let k=0;k<4;k++)r[i*4+j]+=b[i*4+k]*a[k*4+j];}
    return r;
}
function norm(v){const l=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]);return[v[0]/l,v[1]/l,v[2]/l];}
function cross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];}
function dot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2];}

gl.enable(gl.BLEND);
gl.blendFunc(gl.SRC_ALPHA,gl.ONE);

let t=0;
function draw(){
    t+=0.01;
    gl.clearColor(0.04,0.04,0.06,1);
    gl.clear(gl.COLOR_BUFFER_BIT);

    const proj = perspective(0.8, c.width/c.height, 0.1, 100);
    const view = lookAt([Math.sin(t*0.2)*8,2,Math.cos(t*0.2)*8],[0,0,0],[0,1,0]);
    const mvp = mult(proj,view);
    gl.uniformMatrix4fv(mLoc, false, mvp);

    // Draw earth
    gl.bindBuffer(gl.ARRAY_BUFFER, eBuf);
    gl.enableVertexAttribArray(pLoc);
    gl.vertexAttribPointer(pLoc,3,gl.FLOAT,false,0,0);
    gl.drawArrays(gl.POINTS,0,earth.length/3);

    // Update & draw satellites
    for(let i=0;i<DISPLAY;i++){
        const s=sats[i];
        s.ph+=s.sp;
        let x=s.r*Math.cos(s.ph), y=0, z=s.r*Math.sin(s.ph);
        const ci=Math.cos(s.inc),si=Math.sin(s.inc);
        const y1=y*ci-z*si;
        const z1=y*si+z*ci;
        const cr=Math.cos(s.raan),sr=Math.sin(s.raan);
        satPos[i*3]=x*cr+z1*sr; satPos[i*3+1]=y1; satPos[i*3+2]=-x*sr+z1*cr;
    }
    gl.bindBuffer(gl.ARRAY_BUFFER, sBuf);
    gl.bufferData(gl.ARRAY_BUFFER, satPos, gl.DYNAMIC_DRAW);
    gl.vertexAttribPointer(pLoc,3,gl.FLOAT,false,0,0);
    gl.drawArrays(gl.POINTS,0,DISPLAY);

    requestAnimationFrame(draw);
}

document.getElementById('n').textContent = TOTAL.toLocaleString();
onresize=()=>{c.width=innerWidth;c.height=innerHeight;gl.viewport(0,0,c.width,c.height);};
draw();
</script>
</body>
</html>